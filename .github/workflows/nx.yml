name: NX Workspace Migration

on:
  workflow_dispatch:
  schedule:
    - cron: "0 6 * * *"

permissions: write-all

jobs:
  migrate:
    name: "Migrate"
    uses: tsok-org/.github/.github/workflows/nx-migrate.yml@main
    with:
      base_branch: ${{ github.ref_name }}
      github_app_id: ${{ vars.OPERATOR_GITHUB_APPLICATION_ID }}
      node_version_file: ".node-version"
      channel: "stable"
      branch_name_template: "update-nx-{version}"
      commit_message_template: "build: ðŸ“¦ update @nx/workspace to {version}"
      create_pr: true
      pr_title_template: "build: ðŸ“¦ update Nx workspace to {version}"
      pr_labels: "dependencies"
      pr_auto_merge: true
    secrets:
      github_app_private_key: ${{ secrets.OPERATOR_GITHUB_APP_PRIVATE_KEY }}
      nx_cloud_access_token: ${{ secrets.NX_CLOUD_ACCESS_TOKEN }}
